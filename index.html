<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Filipino BMI Meal Planner</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background-color: #fafafa; }
    h1 { color: #2c3e50; }
    h2, h3 { margin-top: 25px; color: #34495e; }
    select, input { margin: 5px 0; padding: 6px; width: 220px; }
    .btn { margin-top: 10px; padding: 6px 12px; background: #2ecc71; border: none; color: white; border-radius: 5px; cursor: pointer; }
    .btn:hover { background: #27ae60; }
    .btn-danger { background: #e74c3c; }
    .btn-danger:hover { background: #c0392b; }
    .profile-list { margin-top: 10px; padding: 10px; border: 1px solid #ccc; background: #fff; max-width: 400px; }
    .meal-day { margin-bottom: 20px; padding: 10px; border: 1px solid #ccc; background: #fff; border-radius: 8px; }
    pre { background: #f4f4f4; padding: 10px; border-radius: 5px; max-width: 400px; }
  </style>
</head>
<body>
  <h1>Filipino BMI Meal Planner</h1>

  <h2>Create Profile</h2>
  <label>Name: <input type="text" id="name"></label><br>
  <label>Age: <input type="number" id="age"></label><br>
  <label>Gender: 
    <select id="gender">
      <option value="male">Male</option>
      <option value="female">Female</option>
    </select>
  </label><br>
  <label>Weight (kg): <input type="number" id="weight"></label><br>
  <label>Height (cm): <input type="number" id="height"></label><br>
  <label>Activity Level:
    <select id="activity">
      <option value="1.2">Sedentary</option>
      <option value="1.375">Lightly active</option>
      <option value="1.55">Moderately active</option>
      <option value="1.725">Very active</option>
      <option value="1.9">Super active</option>
    </select>
  </label><br>

  <h3>Macro Split (%)</h3>
  <label>Protein: <input type="number" id="proteinSplit" value="30"></label><br>
  <label>Carbs: <input type="number" id="carbsSplit" value="40"></label><br>
  <label>Fat: <input type="number" id="fatSplit" value="30"></label><br>

  <h3>Restrictions (optional)</h3>
  <select id="restrictions" multiple>
    <option value="pork">Pork</option>
    <option value="beef">Beef</option>
    <option value="chicken">Chicken</option>
    <option value="fish">Fish</option>
    <option value="veggies">Veggies</option>
    <option value="dairy">Dairy</option>
    <option value="egg">Egg</option>
    <option value="banana">Banana</option>
  </select><br>

  <h3>Plan Goal</h3>
  <select id="goal">
    <option value="maintain">Maintain</option>
    <option value="lose">Lose Weight</option>
    <option value="gain">Gain Weight</option>
  </select><br>

  <button class="btn" onclick="saveProfile()">Save Profile</button>
  <button class="btn" onclick="resetForm()">Reset Form</button>

  <h2>Saved Profiles</h2>
  <div id="savedProfiles" class="profile-list"></div>

  <h2>Profile</h2>
  <pre id="profileInfo"></pre>

  <h2>Meal Plan</h2>
  <button class="btn" onclick="generateMealPlan()">Generate 14-Day Meal Plan</button>
  <button class="btn" onclick="downloadMealPlan()">Download Meal Plan (PDF)</button>
  <div id="mealPlan"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    let profile = null;

    const foodDB = {
      breakfast: [
        { name: "Herbalife Shake", grams: "2 scoops Formula 1 + 200ml Oatside milk", cal: 220, protein: 17, carbs: 28, fat: 5 },
        { name: "Oatmeal with Milk", grams: "40g oats + 200ml milk", cal: 250, protein: 10, carbs: 35, fat: 8 },
        { name: "Pandesal with Egg", grams: "2 pcs pandesal + 1 boiled egg", cal: 280, protein: 12, carbs: 35, fat: 8 },
        { name: "Herbalife Shake + Banana", grams: "2 scoops Formula 1 + 200ml milk + 1 banana", cal: 320, protein: 18, carbs: 55, fat: 6 }
      ],
      lunch: [
        { name: "Chicken Adobo + Rice", grams: "150g chicken + 100g rice", cal: 420, protein: 36, carbs: 35, fat: 14 },
        { name: "Beef Giniling + Veggies", grams: "120g lean beef + 100g mixed veggies + 100g rice", cal: 440, protein: 33, carbs: 40, fat: 14 },
        { name: "Tofu + Rice + Veggies", grams: "150g tofu + 100g rice + 100g veggies", cal: 380, protein: 25, carbs: 40, fat: 12 },
        { name: "Fried Fish + Rice", grams: "120g fish + 100g rice + 50g veggies", cal: 400, protein: 35, carbs: 35, fat: 10 },
        { name: "Tinolang Manok", grams: "1 bowl with rice", cal: 360, protein: 30, carbs: 35, fat: 8 }
      ],
      dinner: [
        { name: "Herbalife Shake", grams: "2 scoops Formula 1 + 200ml Oatside milk", cal: 220, protein: 17, carbs: 28, fat: 5 },
        { name: "Chicken Tinola", grams: "1 bowl with rice", cal: 350, protein: 30, carbs: 32, fat: 8 },
        { name: "Sinigang na Baboy", grams: "1 bowl with rice", cal: 400, protein: 30, carbs: 35, fat: 12 },
        { name: "Vegetable Stir Fry + Rice", grams: "150g mixed veggies + 100g rice", cal: 300, protein: 10, carbs: 50, fat: 5 }
      ],
      snack: [
        { name: "Banana", grams: "120g", cal: 105, protein: 1, carbs: 27, fat: 0 },
        { name: "Boiled Egg", grams: "1 large (50g)", cal: 70, protein: 6, carbs: 1, fat: 5 },
        { name: "SkyFlakes", grams: "3 pcs", cal: 120, protein: 2, carbs: 20, fat: 4 },
        { name: "Fruit Salad (light)", grams: "100g", cal: 160, protein: 2, carbs: 25, fat: 6 },
        { name: "Mixed Nuts", grams: "30g", cal: 170, protein: 6, carbs: 6, fat: 15 }
      ]
    };

    function calculateBMR(weight, height, age, gender) {
      return gender === "male"
        ? 10 * weight + 6.25 * height - 5 * age + 5
        : 10 * weight + 6.25 * height - 5 * age - 161;
    }

    function saveProfile() {
      const name = document.getElementById("name").value.trim();
      if (!name) return alert("Please enter a name.");

      const age = parseInt(document.getElementById("age").value);
      const gender = document.getElementById("gender").value;
      const weight = parseFloat(document.getElementById("weight").value);
      const height = parseFloat(document.getElementById("height").value);
      const activity = parseFloat(document.getElementById("activity").value);
      const goal = document.getElementById("goal").value;

      const bmr = calculateBMR(weight, height, age, gender);
      const maintain = Math.round(bmr * activity);
      const lose = maintain - 500;
      const gain = maintain + 500;

      let targetCalories = goal === "lose" ? lose : goal === "gain" ? gain : maintain;

      const proteinPct = parseInt(document.getElementById("proteinSplit").value);
      const carbsPct = parseInt(document.getElementById("carbsSplit").value);
      const fatPct = parseInt(document.getElementById("fatSplit").value);

      const proteinTarget = Math.round((targetCalories * (proteinPct / 100)) / 4);
      const carbsTarget = Math.round((targetCalories * (carbsPct / 100)) / 4);
      const fatTarget = Math.round((targetCalories * (fatPct / 100)) / 9);

      profile = {
        name, age, gender, weight, height, activity, goal,
        macroSplit: { protein: proteinPct, carbs: carbsPct, fat: fatPct },
        restrictions: Array.from(document.getElementById("restrictions").selectedOptions).map(opt => opt.value),
        bmr, maintain, lose, gain, targetCalories, proteinTarget, carbsTarget, fatTarget
      };

      localStorage.setItem(`profile_${name}`, JSON.stringify(profile));
      displaySavedProfiles();
      showProfileInfo();
      alert("Profile saved!");
    }

    function showProfileInfo() {
      document.getElementById("profileInfo").innerText = `
Name: ${profile.name}
Age: ${profile.age}
Gender: ${profile.gender}
Weight: ${profile.weight} kg
Height: ${profile.height} cm
Goal: ${profile.goal.toUpperCase()}
BMR: ${profile.bmr} kcal/day
Target Calories: ${profile.targetCalories}
Target Macros: Protein ${profile.proteinTarget}g | Carbs ${profile.carbsTarget}g | Fat ${profile.fatTarget}g
Restrictions: ${profile.restrictions.length ? profile.restrictions.join(", ") : "None"}
      `;
    }

    function displaySavedProfiles() {
      const container = document.getElementById("savedProfiles");
      container.innerHTML = "";
      Object.keys(localStorage).filter(k => k.startsWith("profile_")).forEach(key => {
        const prof = JSON.parse(localStorage.getItem(key));
        const div = document.createElement("div");
        div.innerHTML = `
          <b>${prof.name}</b> (${prof.goal})<br>
          <button class="btn" onclick="loadProfile('${prof.name}')">Load</button>
          <button class="btn-danger" onclick="deleteProfile('${prof.name}')">Delete</button>
          <hr>`;
        container.appendChild(div);
      });
    }

    function loadProfile(name) {
      const saved = JSON.parse(localStorage.getItem(`profile_${name}`));
      if (!saved) return;
      profile = saved;
      document.getElementById("name").value = saved.name;
      document.getElementById("age").value = saved.age;
      document.getElementById("gender").value = saved.gender;
      document.getElementById("weight").value = saved.weight;
      document.getElementById("height").value = saved.height;
      document.getElementById("activity").value = saved.activity;
      document.getElementById("goal").value = saved.goal;
      document.getElementById("proteinSplit").value = saved.macroSplit.protein;
      document.getElementById("carbsSplit").value = saved.macroSplit.carbs;
      document.getElementById("fatSplit").value = saved.macroSplit.fat;
      showProfileInfo();
      alert(`Profile "${name}" loaded!`);
    }

    function deleteProfile(name) {
      if (confirm(`Delete profile "${name}"?`)) {
        localStorage.removeItem(`profile_${name}`);
        displaySavedProfiles();
      }
    }

    function resetForm() {
      document.querySelectorAll("input, select").forEach(el => {
        if (el.type === "select-multiple") el.selectedIndex = -1;
        else el.value = "";
      });
      document.getElementById("profileInfo").innerText = "";
      document.getElementById("mealPlan").innerHTML = "";
      profile = null;
      alert("Form cleared!");
    }

    function pickUniqueMeals(type, usedMeals) {
      const available = foodDB[type].filter(m => {
        if (!profile.restrictions.length) return true;
        return !profile.restrictions.some(r => m.name.toLowerCase().includes(r));
      }).filter(m => !usedMeals.includes(m.name));
      if (available.length === 0) return foodDB[type][0];
      const meal = available[Math.floor(Math.random() * available.length)];
      usedMeals.push(meal.name);
      return meal;
    }

    function generateMealPlan() {
      if (!profile) return alert("Save or load a profile first!");

      const planDiv = document.getElementById("mealPlan");
      planDiv.innerHTML = "";
      const used = { breakfast: [], lunch: [], dinner: [], snack: [] };

      for (let day = 1; day <= 14; day++) {
        const meals = {
          breakfast: pickUniqueMeals("breakfast", used.breakfast),
          lunch: pickUniqueMeals("lunch", used.lunch),
          dinner: pickUniqueMeals("dinner", used.dinner),
          snack: pickUniqueMeals("snack", used.snack)
        };

        const totals = Object.values(meals).reduce((a, m) => ({
          cal: a.cal + m.cal, protein: a.protein + m.protein, carbs: a.carbs + m.carbs, fat: a.fat + m.fat
        }), { cal: 0, protein: 0, carbs: 0, fat: 0 });

        const div = document.createElement("div");
        div.className = "meal-day";
        div.innerHTML = `
          <h3>Day ${day}</h3>
          Breakfast: ${meals.breakfast.name} (${meals.breakfast.grams})<br>
          Lunch: ${meals.lunch.name} (${meals.lunch.grams})<br>
          Dinner: ${meals.dinner.name} (${meals.dinner.grams})<br>
          Snack: ${meals.snack.name} (${meals.snack.grams})<br><br>
          <b>Daily Totals:</b> ${totals.cal} kcal | Protein: ${totals.protein}g | Carbs: ${totals.carbs}g | Fat: ${totals.fat}g<br>
          <b>Targets:</b> ${profile.targetCalories} kcal | Protein: ${profile.proteinTarget}g | Carbs: ${profile.carbsTarget}g | Fat: ${profile.fatTarget}g
        `;
        planDiv.appendChild(div);
      }
    }

    function downloadMealPlan() {
      if (!profile) return alert("Save and generate plan first!");
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      doc.setFontSize(12);
      doc.text("14-Day Filipino Meal Plan", 10, 10);
      doc.text(`Name: ${profile.name}`, 10, 20);
      doc.text(`Goal: ${profile.goal}`, 10, 30);
      doc.text(`Target Calories: ${profile.targetCalories}`, 10, 40);

      let y = 50;
      const days = document.querySelectorAll(".meal-day");
      days.forEach(day => {
        if (y > 270) { doc.addPage(); y = 20; }
        doc.text(day.innerText, 10, y);
        y += 60;
      });

      doc.save(`${profile.name}_mealplan.pdf`);
    }

    window.onload = displaySavedProfiles;
  </script>
</body>
</html>
