<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Pinoy Meal Planner — Profiles</title>
<style>
:root{
  --bg:#07090a; --card:#0f1516; --muted:#9aa6a3;
  --neon:#1eff6b; --accent:#12d3ff; --glass-border:rgba(255,255,255,0.04);
  --radius:12px; --maxw:1100px;
}
*{box-sizing:border-box}
body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:linear-gradient(#030405,#07090a);color:#e6f7ea;padding:12px}
.app{max-width:var(--maxw);margin:0 auto;display:grid;grid-template-columns:260px 1fr;gap:12px}
@media(max-width:880px){ .app{grid-template-columns:1fr} }

.panel{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));padding:12px;border-radius:var(--radius);border:1px solid var(--glass-border);box-shadow:0 10px 30px rgba(0,0,0,0.6)}
.header{display:flex;gap:10px;align-items:center;margin-bottom:8px}
.logo{width:56px;height:56px;border-radius:10px;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#081411,#081428);border:1px solid rgba(255,255,255,0.02)}
.title{font-size:16px;color:var(--neon);margin:0}
.subtitle{margin:0;color:var(--muted);font-size:13px}

.side{height:78vh;overflow:auto;padding:8px}
.side h3{color:var(--accent);margin:6px 0 10px}
.profile-item{display:flex;align-items:center;gap:10px;padding:8px;border-radius:10px;margin-bottom:8px;cursor:pointer;border:1px solid rgba(255,255,255,0.02)}
.profile-item:hover{background:rgba(30,255,107,0.02)}
.profile-item .mini{width:44px;height:44px;border-radius:8px;flex-shrink:0;display:flex;align-items:center;justify-content:center;background:#071010;color:var(--muted);font-size:12px}
.profile-meta{flex:1}
.profile-name{font-weight:700;color:#eaffef;margin:0}
.profile-sub{font-size:12px;color:var(--muted);margin:0}

.controls{display:flex;gap:8px;margin-top:8px}
.btn{background:linear-gradient(90deg,var(--neon),var(--accent));color:#00110a;border:none;padding:10px;border-radius:10px;font-weight:700;cursor:pointer}
.btn.secondary{background:transparent;border:1px solid rgba(255,255,255,0.03);color:var(--neon)}
.small{padding:8px 10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:var(--muted);font-size:13px}

.form-row{display:flex;gap:8px}
.form-row .col{flex:1}
label{display:block;color:var(--muted);font-size:13px;margin-bottom:6px}
input[type="text"], input[type="number"], select{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:#eafef0}

.steps{display:grid;gap:12px}
.step{display:none}
.step.active{display:block}

.meal-week{display:flex;flex-direction:column;gap:10px;margin-top:8px}
.day-card{display:flex;gap:10px;padding:10px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.02)}
.thumb{width:120px;height:84px;border-radius:8px;overflow:hidden;background:#071010;flex-shrink:0;display:flex;align-items:center;justify-content:center}
.meal-info{flex:1}
.meal-title{font-weight:700;color:#eafef0;margin:0 0 6px 0}
.meta{color:var(--muted);font-size:13px}
.macro-row{display:flex;gap:8px;margin-top:8px}
.pill{padding:6px 8px;border-radius:8px;font-weight:700;font-size:12px;color:#00110a;background:linear-gradient(90deg,var(--neon),var(--accent))}

.totals{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap}
.tot{flex:1;min-width:120px;background:rgba(255,255,255,0.02);padding:8px;border-radius:10px;text-align:center}

.footer{margin-top:10px;color:var(--muted);font-size:13px;text-align:center}

/* small icons */
.icon-btn{background:transparent;border:1px solid rgba(255,255,255,0.02);color:var(--muted);padding:8px;border-radius:8px;cursor:pointer}

/* tiny responsive */
@media(max-width:500px){
  .thumb{width:90px;height:66px}
  .profile-item .mini{width:36px;height:36px}
}
</style>
</head>
<body>
<div style="max-width:var(--maxw);margin:0 auto;padding:8px">
  <div class="header">
    <div class="logo" aria-hidden>
      <svg width="36" height="36" viewBox="0 0 24 24" fill="none"><defs><linearGradient id="g" x1="0" x2="1"><stop offset="0" stop-color="#1eff6b"/><stop offset="1" stop-color="#12d3ff"/></linearGradient></defs><path d="M3 12c1.5-5 7-9 12-9 0 0-4.5 6-2 11 2.5 5 6.5 7 6.5 7s-6.5-1.5-12-7C3.5 13.5 3 12 3 12z" fill="url(#g)"/></svg>
    </div>
    <div>
      <div class="title">Pinoy Meal Planner</div>
      <div class="subtitle">Profiles • Randomized weekly plans • Herbalife included</div>
    </div>
  </div>

  <div class="app">

    <!-- LEFT: profiles -->
    <div class="panel side">
      <h3>Profiles</h3>
      <div id="profilesList"></div>
      <div style="margin-top:8px">
        <button class="btn" onclick="showCreate()">+ Create new profile</button>
      </div>
      <div style="margin-top:12px">
        <div style="display:flex;gap:8px">
          <button class="small" onclick="exportAll()">Export all JSON</button>
          <button class="small" onclick="importAll()">Import JSON</button>
        </div>
      </div>
    </div>

    <!-- RIGHT: main -->
    <div>
      <div class="panel">
        <div class="steps">

          <!-- create / edit / multi-step -->
          <div id="formWrap">
            <div class="step active" id="stepA">
              <label>Your name</label>
              <input id="p_name" type="text" placeholder="Name (e.g., James)">
              <div style="display:flex;gap:8px;margin-top:8px">
                <button class="btn" onclick="toStepB()">Next</button>
              </div>
            </div>

            <div class="step" id="stepB">
              <div class="form-row">
                <div class="col">
                  <label>Height (cm)</label>
                  <input id="p_height" type="number" min="50" placeholder="170">
                </div>
                <div class="col">
                  <label>Weight (kg)</label>
                  <input id="p_weight" type="number" min="20" step="0.1" placeholder="75">
                </div>
              </div>
              <div class="form-row" style="margin-top:8px">
                <div class="col">
                  <label>Age</label>
                  <input id="p_age" type="number" min="10" placeholder="35">
                </div>
                <div class="col">
                  <label>Sex</label>
                  <select id="p_sex"><option value="male">Male</option><option value="female">Female</option></select>
                </div>
              </div>
              <div style="display:flex;gap:8px;margin-top:10px">
                <button class="btn" onclick="toStepC()">Next — Goal</button>
                <button class="btn secondary" onclick="cancelCreate()">Cancel</button>
              </div>
            </div>

            <div class="step" id="stepC">
              <label>Goal</label>
              <select id="p_goal"><option value="lose">Lose weight</option><option value="maintain">Maintain</option><option value="gain">Build muscle</option></select>
              <div style="margin-top:8px">
                <label><input id="p_alwaysHerb" type="checkbox" checked> Always include Herbalife shake for breakfast & dinner</label>
              </div>
              <div style="display:flex;gap:8px;margin-top:10px">
                <button class="btn" onclick="toStepD()">Next — Allergies</button>
                <button class="btn secondary" onclick="backToB()">Back</button>
              </div>
            </div>

            <div class="step" id="stepD">
              <label>Allergies (comma separated)</label>
              <input id="p_allergies" type="text" placeholder="egg, milk, peanut, soy">
              <div style="display:flex;gap:8px;margin-top:10px">
                <button class="btn" onclick="createProfile()">Create profile & generate plan</button>
                <button class="btn secondary" onclick="backToC()">Back</button>
              </div>
            </div>
          </div>

          <!-- results -->
          <div id="resultWrap" class="step" style="display:none">
            <div style="display:flex;justify-content:space-between;align-items:center;gap:8px">
              <div>
                <div style="font-weight:700;color:var(--neon)" id="r_name">Name</div>
                <div style="color:var(--muted);font-size:13px" id="r_meta">meta</div>
              </div>
              <div style="display:flex;gap:8px;align-items:center">
                <button class="small" onclick="regenerateProfile()">Regenerate</button>
                <button class="small" onclick="downloadProfile()">Download</button>
                <button class="small" onclick="deleteCurrent()">Delete</button>
              </div>
            </div>

            <div style="margin-top:8px" id="summaryPanel" class="panel">
              <div id="summaryStats"></div>
            </div>

            <div class="meal-week" id="weekContainer"></div>
            <div class="totals" id="dailyTotals"></div>
          </div>

        </div>
      </div>

      <div class="footer">Saved locally in your browser. Profiles persist unless you clear site data.</div>
    </div>
  </div>
</div>

<script>
/* ---------------- initial meal library (Filipino-friendly) --------------- 
   For "built-in images for fast loading" we generate small SVG thumbnails on the fly (data URLs). 
   This keeps everything single-file and instant to load without remote requests.
-------------------------------------------------------------------------*/

const HERBALIFE = {name:"Herbalife Formula 1 + 200ml Oatside", cal:200, protein:18, carbs:20, fat:4, tag:"shake"};
const MEALS = {
  lunch: [
    {name:"Grilled Chicken Adobo (lean)", cal:420, protein:38, carbs:30, fat:18, tag:"chicken"},
    {name:"Tinolang Manok (chicken & veg)", cal:320, protein:34, carbs:10, fat:12, tag:"chicken"},
    {name:"Sinigang na Isda (tamarind fish)", cal:350, protein:34, carbs:28, fat:10, tag:"fish"},
    {name:"Inihaw na Tilapia with brown rice", cal:460, protein:36, carbs:50, fat:10, tag:"fish"},
    {name:"Pinakbet with tokwa", cal:380, protein:12, carbs:30, fat:18, tag:"veg"},
    {name:"Grilled Bangus (milkfish)", cal:420, protein:38, carbs:30, fat:14, tag:"fish"},
    {name:"Pork Giniling (lean) with camote", cal:450, protein:30, carbs:40, fat:18, tag:"pork"},
    {name:"Munggo with shrimp", cal:360, protein:22, carbs:45, fat:8, tag:"legume"},
    {name:"Baked Salmon & kamote", cal:520, protein:44, carbs:45, fat:18, tag:"fish"}
  ],
  snack: [
    {name:"Boiled Eggs (2) & banana", cal:210, protein:14, carbs:25, fat:8, tag:"egg"},
    {name:"Papaya & low-fat yogurt", cal:190, protein:9, carbs:30, fat:4, tag:"fruit"},
    {name:"Tuna on brown toast", cal:240, protein:22, carbs:20, fat:8, tag:"tuna"},
    {name:"Camote slices", cal:180, protein:2, carbs:40, fat:0, tag:"veg"},
    {name:"Tokwa slices with vinegar", cal:230, protein:16, carbs:12, fat:14, tag:"tofu"},
    {name:"Fresh mango slices", cal:160, protein:2, carbs:40, fat:0, tag:"fruit"}
  ]
};

/* ---------- utility functions ---------- */
function $(id){return document.getElementById(id)}
function svgThumb(text, color="#1eff6b"){ // returns data URL for a tiny SVG thumbnail with meal name initials
  const initials = text.split(' ').slice(0,3).map(w=>w[0]).join('').toUpperCase();
  const svg = `<svg xmlns='http://www.w3.org/2000/svg' width='320' height='220'>
    <rect width='100%' height='100%' rx='12' fill='#071010'/>
    <g font-family='Arial' text-anchor='middle'>
      <circle cx='50' cy='50' r='32' fill='${color}' opacity='0.12'/>
      <text x='160' y='120' font-size='20' fill='${color}'>${initials}</text>
      <text x='160' y='150' font-size='12' fill='#bfeec8'>${escapeHtml(text)}</text>
    </g>
  </svg>`;
  return 'data:image/svg+xml;utf8,'+encodeURIComponent(svg);
}
function escapeHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/"/g,'&quot;').replace(/</g,'&lt;').replace(/>/g,'&gt;')}

/* ---------- BMR & macros ---------- */
function calcBMR(weight, heightCm, age, sex){
  if(sex==='male') return Math.round(10*weight + 6.25*heightCm - 5*age + 5);
  return Math.round(10*weight + 6.25*heightCm - 5*age - 161);
}
function getTargets(bmr, goal){
  let cal, ratios;
  if(goal==='lose'){ cal=Math.round(bmr*0.85); ratios={p:0.35,c:0.35,f:0.30}; }
  else if(goal==='gain'){ cal=Math.round(bmr*1.15); ratios={p:0.30,c:0.45,f:0.25}; }
  else { cal=Math.round(bmr*1.0); ratios={p:0.30,c:0.40,f:0.30}; }
  return {
    calTarget:cal,
    protein_g: Math.round(cal*ratios.p/4),
    carbs_g: Math.round(cal*ratios.c/4),
    fats_g: Math.round(cal*ratios.f/9)
  };
}

/* ---------- profiles storage ---------- */
const STORAGE_KEY = 'pinoy_meal_profiles_v1';
function loadProfiles(){ try{ const raw = localStorage.getItem(STORAGE_KEY); return raw?JSON.parse(raw):[] }catch(e){return[]} }
function saveProfiles(arr){ localStorage.setItem(STORAGE_KEY, JSON.stringify(arr)) }

/* ---------- render profiles list ---------- */
function renderProfiles(){
  const list = $('profilesList'); list.innerHTML='';
  const profiles = loadProfiles();
  if(profiles.length===0){
    list.innerHTML = `<div style="color:var(--muted);font-size:13px">No profiles yet. Click "Create new profile".</div>`; return;
  }
  profiles.forEach((p, idx)=>{
    const el = document.createElement('div'); el.className='profile-item';
    el.onclick = ()=>loadProfile(idx);
    const mini = document.createElement('div'); mini.className='mini';
    mini.innerHTML = `<svg width="28" height="28" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="8" r="3" fill="#1eff6b" /><rect x="6" y="14" width="12" height="6" rx="2" fill="#12d3ff"/></svg>`;
    const meta = document.createElement('div'); meta.className='profile-meta';
    meta.innerHTML = `<div class="profile-name">${escapeHtml(p.name)}</div><div class="profile-sub">Goal: ${p.goal} • ${p.weight}kg</div>`;
    el.appendChild(mini); el.appendChild(meta);
    // add tiny delete icon
    const del = document.createElement('button'); del.className='small'; del.style.marginLeft='8px'; del.textContent='Delete';
    del.onclick = (ev)=>{ ev.stopPropagation(); if(confirm('Delete profile "'+p.name+'"?')){ deleteProfile(idx); } };
    el.appendChild(del);
    list.appendChild(el);
  });
}

/* ---------- profile lifecycle ---------- */
function showCreate(){
  // reset form
  $('p_name').value=''; $('p_height').value=''; $('p_weight').value=''; $('p_age').value=''; $('p_sex').value='male';
  $('p_goal').value='lose'; $('p_allergies').value=''; $('p_alwaysHerb').checked=true;
  document.querySelectorAll('.step').forEach(s=>s.classList.remove('active'));
  $('stepA').classList.add('active');
  $('resultWrap').style.display='none';
  $('formWrap').style.display='block';
}
function cancelCreate(){ renderProfiles(); document.querySelectorAll('.step').forEach(s=>s.classList.remove('active')); $('stepA').classList.add('active'); }

/* step navigation */
function toStepB(){
  if(!$('p_name').value.trim()){ alert('Please enter a name'); return; }
  document.querySelectorAll('.step').forEach(s=>s.classList.remove('active')); $('stepB').classList.add('active');
}
function toStepC(){ document.querySelectorAll('.step').forEach(s=>s.classList.remove('active')); $('stepC').classList.add('active'); }
function toStepD(){ document.querySelectorAll('.step').forEach(s=>s.classList.remove('active')); $('stepD').classList.add('active'); }
function backToB(){ document.querySelectorAll('.step').forEach(s=>s.classList.remove('active')); $('stepB').classList.add('active'); }
function backToC(){ document.querySelectorAll('.step').forEach(s=>s.classList.remove('active')); $('stepC').classList.add('active'); }

/* create profile + generate plan */
function createProfile(){
  const name = $('p_name').value.trim(); if(!name) { alert('Name required'); return; }
  const height = Number($('p_height').value); const weight = Number($('p_weight').value); const age = Number($('p_age').value);
  const sex = $('p_sex').value; const goal = $('p_goal').value; const allergies = $('p_allergies').value.split(',').map(s=>s.trim().toLowerCase()).filter(Boolean);
  const alwaysHerb = $('p_alwaysHerb').checked;

  if(!height||!weight||!age){ alert('Please fill height, weight, age.'); return; }

  const prof = { name, height, weight, age, sex, goal, allergies, alwaysHerb, created:Date.now() };
  // generate plan object
  const planObj = buildWeek(prof);
  prof.plan = planObj;
  // persist
  const profiles = loadProfiles(); profiles.push(prof); saveProfiles(profiles);
  renderProfiles();
  // open
  const idx = profiles.length-1; loadProfile(idx);
}

/* delete profile */
function deleteProfile(idx){
  const profiles = loadProfiles(); profiles.splice(idx,1); saveProfiles(profiles); renderProfiles();
  // if current is this index, clear view
  if(window.CURRENT_INDEX === idx){ $('resultWrap').style.display='none'; $('formWrap').style.display='block'; }
}

/* load profile */
let CURRENT_INDEX = null;
function loadProfile(idx){
  const profiles = loadProfiles(); const p = profiles[idx];
  if(!p) return;
  CURRENT_INDEX = idx;
  // display meta
  $('r_name').innerText = p.name;
  $('r_meta').innerText = `Goal: ${p.goal} • ${p.weight}kg • ${p.height}cm • ${p.age}yo`;
  // show summary and week
  displayPlan(p);
  // reveal result pane
  $('formWrap').style.display='none';
  $('resultWrap').style.display='block';
  // highlight in list? (skip for simplicity)
}

/* build week (randomized) */
function buildWeek(profile){
  // profile contains: name, height, weight, age, sex, goal, allergies, alwaysHerb
  const bmr = calcBMR(profile.weight, profile.height, profile.age, profile.sex);
  const targets = getTargets(bmr, profile.goal);
  const allergies = (profile.allergies||[]).map(a=>a.toLowerCase());
  // filter pools
  const lunches = MEALS.lunch.filter(m => !allergies.some(k=>m.name.toLowerCase().includes(k) || (m.tag && m.tag.includes(k))));
  const snacks = MEALS.snack.filter(m => !allergies.some(k=>m.name.toLowerCase().includes(k) || (m.tag && m.tag.includes(k))));
  if(lunches.length===0 || snacks.length===0){ alert('All meal options filtered by allergies — change allergies'); return null; }

  const week = [];
  for(let day=0; day<7; day++){
    const breakfast = profile.alwaysHerb ? HERBALIFE : randomFrom(lunches); // if not herbalife, use small lunch-like breakfast
    const lunch = randomFrom(lunches);
    const dinner = profile.alwaysHerb ? HERBALIFE : randomFrom(lunches);
    const snack = randomFrom(snacks);
    const totals = {
      cal: breakfast.cal + lunch.cal + dinner.cal + snack.cal,
      protein: breakfast.protein + lunch.protein + dinner.protein + snack.protein,
      carbs: breakfast.carbs + lunch.carbs + dinner.carbs + snack.carbs,
      fat: breakfast.fat + lunch.fat + dinner.fat + snack.fat
    };
    week.push({day:day+1, breakfast, lunch, dinner, snack, totals});
  }
  return {bmr, targets, week};
}

function randomFrom(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

/* display plan */
function displayPlan(profile){
  if(!profile.plan) { alert('No plan found'); return; }
  const obj = profile.plan;
  // summary
  $('summaryStats').innerHTML = `
    <div class="stat"><div class="k">BMR</div><div class="v">${obj.bmr} kcal</div></div>
    <div class="stat"><div class="k">Cal target</div><div class="v">${obj.targets.calTarget} kcal/day</div></div>
    <div class="stat"><div class="k">Protein</div><div class="v">${obj.targets.protein_g} g/day</div></div>
    <div class="stat"><div class="k">Carbs</div><div class="v">${obj.targets.carbs_g} g/day</div></div>
    <div class="stat"><div class="k">Fat</div><div class="v">${obj.targets.fats_g} g/day</div></div>
  `;
  // week
  const container = $('weekContainer'); container.innerHTML='';
  obj.week.forEach(d=>{
    const card = document.createElement('div'); card.className='day-card';
    const thumb = document.createElement('div'); thumb.className='thumb';
    // create svg thumb
    const color = (d.lunch.tag==='fish')?'#12d3ff':'#1eff6b';
    const dataUrl = svgThumb(d.lunch.name, color);
    const img = document.createElement('img'); img.src = dataUrl; img.alt = d.lunch.name; img.style.width='100%'; img.style.height='100%'; img.style.objectFit='cover';
    thumb.appendChild(img);
    const info = document.createElement('div'); info.className='meal-info';
    info.innerHTML = `<div class="meal-title">Day ${d.day} — ${d.totals.cal} kcal</div>
      <div class="meta">Breakfast: ${d.breakfast.name} • ${d.breakfast.cal} kcal</div>
      <div class="meta">Lunch: ${d.lunch.name} • ${d.lunch.cal} kcal</div>
      <div class="meta">Dinner: ${d.dinner.name} • ${d.dinner.cal} kcal</div>
      <div class="meta">Snack: ${d.snack.name} • ${d.snack.cal} kcal</div>
      <div class="macro-row">
        <div class="pill">P ${d.totals.protein}g</div>
        <div class="pill" style="background:linear-gradient(90deg,#12d3ff,#1eff6b)">C ${d.totals.carbs}g</div>
        <div class="pill" style="background:linear-gradient(90deg,#ffb86b,#ffcc80)">F ${d.totals.fat}g</div>
      </div>`;
    card.appendChild(thumb); card.appendChild(info);
    container.appendChild(card);
  });
  // daily totals summary (first day shown as example)
  const firstTotals = obj.week[0].totals;
  $('dailyTotals').innerHTML = `<div class="tot"><div style="color:var(--muted)">Example Day (Day 1)</div><div style="font-weight:700">${firstTotals.cal} kcal</div></div>
    <div class="tot"><div style="color:var(--muted)">Protein</div><div style="font-weight:700">${firstTotals.protein} g</div></div>
    <div class="tot"><div style="color:var(--muted)">Carbs</div><div style="font-weight:700">${firstTotals.carbs} g</div></div>
    <div class="tot"><div style="color:var(--muted)">Fat</div><div style="font-weight:700">${firstTotals.fat} g</div></div>`;
}

/* regenerate current profile's plan (new random week) */
function regenerateProfile(){
  if(CURRENT_INDEX===null){ alert('Open a profile first'); return; }
  const profiles = loadProfiles(); const p = profiles[CURRENT_INDEX];
  const newPlan = buildWeek(p);
  p.plan = newPlan; profiles[CURRENT_INDEX]=p; saveProfiles(profiles);
  displayPlan(p);
}

/* download single */
function downloadProfile(){
  if(CURRENT_INDEX===null){ alert('Open profile first'); return; }
  const profiles = loadProfiles(); const p = profiles[CURRENT_INDEX];
  const dataStr = "data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(p,null,2));
  const a=document.createElement('a'); a.href=dataStr; a.download = `${p.name.replace(/\s+/g,'_')}_plan.json`; document.body.appendChild(a); a.click(); a.remove();
}

/* delete current */
function deleteCurrent(){
  if(CURRENT_INDEX===null) return;
  const profiles = loadProfiles(); if(!profiles[CURRENT_INDEX]) return;
  const name = profiles[CURRENT_INDEX].name;
  if(confirm('Delete profile "'+name+'"? This cannot be undone.')){
    profiles.splice(CURRENT_INDEX,1); saveProfiles(profiles); renderProfiles(); CURRENT_INDEX=null;
    // reset view
    $('resultWrap').style.display='none'; $('formWrap').style.display='block'; document.querySelectorAll('.step').forEach(s=>s.classList.remove('active')); $('stepA').classList.add('active');
  }
}

/* export/import all */
function exportAll(){
  const profiles = loadProfiles();
  if(profiles.length===0){ alert('No profiles'); return; }
  const dataStr = "data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(profiles,null,2));
  const a=document.createElement('a'); a.href=dataStr; a.download='all_profiles.json'; document.body.appendChild(a); a.click(); a.remove();
}
function importAll(){
  const input = document.createElement('input'); input.type='file'; input.accept='.json,application/json';
  input.onchange = e => {
    const f = e.target.files[0];
    if(!f) return;
    const reader = new FileReader();
    reader.onload = ev => {
      try{
        const data = JSON.parse(ev.target.result);
        if(!Array.isArray(data)) throw new Error('Invalid file');
        // merge: append
        const existing = loadProfiles(); const merged = existing.concat(data);
        saveProfiles(merged); renderProfiles(); alert('Imported '+data.length+' profiles');
      }catch(err){ alert('Import failed: '+err.message) }
    };
    reader.readAsText(f);
  };
  input.click();
}

/* init */
renderProfiles();
/* expose create UI show */
showCreate();
</script>
</body>
</html>
