<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>14-Day Meal Plan</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  <h1>14-Day Meal Plan Generator</h1>
  <button onclick="downloadPDF()">Download PDF</button>

  <script>
    const { jsPDF } = window.jspdf;

    const profile = {
      age: 37,
      weight: 77,   // kg
      height: 165,  // cm
      gender: "male",
      activity: "sedentary"  // sedentary, light, moderate, active, very_active
    };

    const mealData = {
      breakfast: {
        "2 scoops Herbalife Formula 1 shake with 200ml Oatside milk": { cal: 250, protein: 17 }
      },
      lunch: {
        "Grilled chicken breast with 1 cup rice": { cal: 450, protein: 35 },
        "Beef stir-fry with 1 cup rice": { cal: 500, protein: 32 },
        "Fish fillet with 1 cup rice": { cal: 420, protein: 30 },
        "Tofu and vegetables with 1 cup rice": { cal: 380, protein: 22 },
        "Pork adobo (lean cuts) with 1 cup rice": { cal: 460, protein: 32 },
        "Chicken tinola with 1 cup rice": { cal: 400, protein: 34 },
        "Grilled bangus with 1 cup rice": { cal: 430, protein: 29 },
        "Ginisang ampalaya with egg + 1 cup rice": { cal: 390, protein: 24 },
        "Chicken afritada with 1 cup rice": { cal: 440, protein: 33 },
        "Beef tapa with 1 cup rice": { cal: 470, protein: 31 },
        "Chicken curry (light coconut milk) with 1 cup rice": { cal: 450, protein: 32 },
        "Sinigang na hipon with 1 cup rice": { cal: 400, protein: 28 },
        "Pork sinigang with 1 cup rice": { cal: 470, protein: 30 },
        "Grilled tilapia with 1 cup rice": { cal: 420, protein: 28 }
      },
      dinner: {
        "2 scoops Herbalife Formula 1 shake with 200ml Oatside milk": { cal: 250, protein: 17 }
      },
      snack: {
        "Banana": { cal: 105, protein: 1 },
        "Egg": { cal: 78, protein: 6 },
        "Banana + Egg": { cal: 183, protein: 7 },
        "Salad": { cal: 120, protein: 3 },
        "Greek yogurt (100g)": { cal: 60, protein: 10 },
        "Apple": { cal: 95, protein: 0 },
        "Peanut butter (1 tbsp) with cucumber slices": { cal: 120, protein: 4 }
      }
    };

    // ---------- BMR + Calorie Needs ----------
    function calculateBMR(profile) {
      let { age, weight, height, gender, activity } = profile;
      let bmr;

      if (gender === "male") {
        bmr = 10 * weight + 6.25 * height - 5 * age + 5;
      } else {
        bmr = 10 * weight + 6.25 * height - 5 * age - 161;
      }

      const activityLevels = {
        sedentary: 1.2,
        light: 1.375,
        moderate: 1.55,
        active: 1.725,
        very_active: 1.9
      };

      let maintenance = bmr * activityLevels[activity];
      let fatLoss = maintenance - 500;
      let muscleGain = maintenance + 300;

      return { bmr, maintenance, fatLoss, muscleGain };
    }

    // ---------- Meal Plan Generator ----------
    function shuffle(array) {
      let arr = [...array];
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function generateMealPlan(profile) {
      const breakfasts = Object.keys(mealData.breakfast);
      const lunches = Object.keys(mealData.lunch);
      const dinners = Object.keys(mealData.dinner);
      const snacks = Object.keys(mealData.snack);

      // shuffle to create unique cycle
      let lunchCycle = shuffle(lunches);
      let snackCycle = shuffle(snacks);

      // expand to 14 days
      while (lunchCycle.length < 14) lunchCycle = lunchCycle.concat(shuffle(lunches));
      while (snackCycle.length < 14) snackCycle = snackCycle.concat(shuffle(snacks));

      let plan = [];
      for (let i = 0; i < 14; i++) {
        let breakfast = breakfasts[0];  // fixed shake
        let dinner = dinners[0];        // fixed shake
        let lunch = lunchCycle[i];
        let snack = snackCycle[i];

        plan.push({
          day: i + 1,
          breakfast: { name: breakfast, ...mealData.breakfast[breakfast] },
          lunch: { name: lunch, ...mealData.lunch[lunch] },
          snack: { name: snack, ...mealData.snack[snack] },
          dinner: { name: dinner, ...mealData.dinner[dinner] },
          totals: {
            cal: mealData.breakfast[breakfast].cal +
                 mealData.lunch[lunch].cal +
                 mealData.snack[snack].cal +
                 mealData.dinner[dinner].cal,
            protein: mealData.breakfast[breakfast].protein +
                     mealData.lunch[lunch].protein +
                     mealData.snack[snack].protein +
                     mealData.dinner[dinner].protein
          }
        });
      }
      return plan;
    }

    // ---------- PDF Generator ----------
    function downloadPDF() {
      const doc = new jsPDF();
      let y = 10;

      // show client calorie info
      const calc = calculateBMR(profile);
      doc.text(`BMR: ${calc.bmr.toFixed(0)} kcal/day`, 10, y); y += 10;
      doc.text(`Maintenance Calories: ${calc.maintenance.toFixed(0)} kcal/day`, 10, y); y += 10;
      doc.text(`Recommended for Fat Loss: ${calc.fatLoss.toFixed(0)} kcal/day`, 10, y); y += 10;
      doc.text(`Recommended for Muscle Gain: ${calc.muscleGain.toFixed(0)} kcal/day`, 10, y); y += 20;

      // meal plan
      const plan = generateMealPlan(profile);
      plan.forEach(day => {
        doc.text(`Day ${day.day}`, 10, y); y += 8;
        doc.text(`  Breakfast: ${day.breakfast.name} (${day.breakfast.cal} cal, ${day.breakfast.protein}g protein)`, 10, y); y += 8;
        doc.text(`  Lunch: ${day.lunch.name} (${day.lunch.cal} cal, ${day.lunch.protein}g protein)`, 10, y); y += 8;
        doc.text(`  Snack: ${day.snack.name} (${day.snack.cal} cal, ${day.snack.protein}g protein)`, 10, y); y += 8;
        doc.text(`  Dinner: ${day.dinner.name} (${day.dinner.cal} cal, ${day.dinner.protein}g protein)`, 10, y); y += 8;
        doc.text(`  Totals: ${day.totals.cal} cal, ${day.totals.protein}g protein`, 10, y); y += 12;

        if (y > 270) { doc.addPage(); y = 10; }
      });

      doc.save("mealplan.pdf");
    }
  </script>
</body>
</html>
