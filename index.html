<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Pinoy 14-Day Meal Planner</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    button { margin: 5px; }
    .profile-card { border: 1px solid #ccc; padding: 10px; margin: 5px; display: inline-block; }
    #bmrInfo { margin-top: 20px; font-weight: bold; }
    #planOutput { margin-top: 20px; white-space: pre-wrap; }
  </style>
</head>
<body>
  <h2>Pinoy 14-Day Meal Planner (PDF + Edit)</h2>
  
  <h3>Profiles</h3>
  <div id="profiles"></div>
  <button onclick="addProfile()">Add Profile</button>
  
  <div id="bmrInfo"></div>
  <div id="planOutput"></div>
  
  <button onclick="generatePlan()">Generate Meal Plan</button>
  <button onclick="downloadPDF()">Download PDF</button>
  
<script>
let profiles = JSON.parse(localStorage.getItem("profiles") || "[]");
let selectedProfile = null;
let currentPlan = [];

function saveProfiles() {
  localStorage.setItem("profiles", JSON.stringify(profiles));
  renderProfiles();
}

function renderProfiles() {
  let container = document.getElementById("profiles");
  container.innerHTML = "";
  profiles.forEach((p, i) => {
    let div = document.createElement("div");
    div.className = "profile-card";
    div.innerHTML = `
      <b>${p.name}</b><br>
      Age: ${p.age}, Weight: ${p.weight}kg, Height: ${p.height}cm, Gender: ${p.gender}<br>
      Activity: ${p.activity}<br>
      <button onclick="selectProfile(${i})">Select</button>
      <button onclick="editProfile(${i})">Edit</button>
      <button onclick="deleteProfile(${i})">Delete</button>
    `;
    container.appendChild(div);
  });
}
renderProfiles();

function addProfile() {
  let name = prompt("Name?");
  if (!name) return;
  let age = +prompt("Age?");
  let weight = +prompt("Weight (kg)?");
  let height = +prompt("Height (cm)?");
  let gender = prompt("Gender (male/female)?", "male");
  let activity = prompt("Activity (sedentary/light/moderate/active/very_active)?", "sedentary");
  profiles.push({ name, age, weight, height, gender, activity });
  saveProfiles();
}

function editProfile(i) {
  let p = profiles[i];
  p.name = prompt("Name?", p.name) || p.name;
  p.age = +prompt("Age?", p.age) || p.age;
  p.weight = +prompt("Weight (kg)?", p.weight) || p.weight;
  p.height = +prompt("Height (cm)?", p.height) || p.height;
  p.gender = prompt("Gender (male/female)?", p.gender) || p.gender;
  p.activity = prompt("Activity (sedentary/light/moderate/active/very_active)?", p.activity) || p.activity;
  saveProfiles();
}

function deleteProfile(i) {
  if (confirm("Delete this profile?")) {
    profiles.splice(i, 1);
    saveProfiles();
  }
}

function selectProfile(i) {
  selectedProfile = profiles[i];
  alert("Selected " + selectedProfile.name);
}

function calculateBMR(profile) {
  let { age, weight, height, gender, activity } = profile;
  let bmr;
  if (gender === "male") {
    bmr = 10 * weight + 6.25 * height - 5 * age + 5;
  } else {
    bmr = 10 * weight + 6.25 * height - 5 * age - 161;
  }
  const activityLevels = {
    sedentary: 1.2,
    light: 1.375,
    moderate: 1.55,
    active: 1.725,
    very_active: 1.9
  };
  let maintenance = bmr * (activityLevels[activity] || 1.2);
  return { 
    bmr, 
    maintenance, 
    fatLoss: maintenance - 500, 
    muscleGain: maintenance + 300 
  };
}

const meals = {
  breakfast: { "Herbalife Shake + Oatside Milk": { cal: 250, protein: 15 } },
  dinner:    { "Herbalife Shake + Oatside Milk": { cal: 250, protein: 15 } },
  lunch: {
    "Grilled chicken breast + 1 cup rice + vegetables": { cal: 450, protein: 35 },
    "Fish fillet + 1 cup rice + vegetables": { cal: 430, protein: 33 },
    "Lean pork adobo + 1 cup rice + vegetables": { cal: 480, protein: 30 },
    "Tofu stir-fry + 1 cup rice": { cal: 400, protein: 20 },
    "Beef tapa + 1 cup rice + vegetables": { cal: 500, protein: 32 },
    "Chicken tinola + 1 cup rice": { cal: 420, protein: 28 },
    "Sinigang na hipon + 1 cup rice": { cal: 410, protein: 26 },
    "Beef nilaga + 1 cup rice": { cal: 480, protein: 30 },
    "Chicken curry + 1 cup rice": { cal: 470, protein: 28 },
    "Ginisang monggo + 1 cup rice": { cal: 390, protein: 22 }
  },
  snack: {
    "Banana": { cal: 105, protein: 1 },
    "Egg": { cal: 78, protein: 6 },
    "Banana + Egg": { cal: 183, protein: 7 },
    "Salad": { cal: 120, protein: 3 },
    "Greek yogurt (100g)": { cal: 60, protein: 10 },
    "Apple": { cal: 95, protein: 0 },
    "Peanut butter (1 tbsp) with cucumber slices": { cal: 120, protein: 4 }
  }
};

function getUniqueMeals(mealOptions, days) {
  let keys = Object.keys(mealOptions);
  let plan = [];
  let used = new Set();
  for (let i = 0; i < days; i++) {
    let available = keys.filter(k => !used.has(k));
    if (available.length === 0) { used.clear(); available = keys; }
    let choice = available[Math.floor(Math.random() * available.length)];
    used.add(choice);
    plan.push({ name: choice, ...mealOptions[choice] });
  }
  return plan;
}

function generatePlan() {
  if (!selectedProfile) return alert("Select a profile first!");
  let calc = calculateBMR(selectedProfile);

  // show on page
  document.getElementById("bmrInfo").innerHTML = `
    <p>BMR: ${calc.bmr.toFixed(0)} kcal/day</p>
    <p>Maintenance Calories: ${calc.maintenance.toFixed(0)} kcal/day</p>
    <p>Recommended for Fat Loss: ${calc.fatLoss.toFixed(0)} kcal/day</p>
    <p>Recommended for Muscle Gain: ${calc.muscleGain.toFixed(0)} kcal/day</p>
  `;

  let lunchPlan = getUniqueMeals(meals.lunch, 14);
  let snackPlan = getUniqueMeals(meals.snack, 14);

  currentPlan = [];
  let out = "";
  for (let day = 0; day < 14; day++) {
    let planDay = {
      day: day+1,
      breakfast: { name: "Herbalife Shake + Oatside Milk", ...meals.breakfast["Herbalife Shake + Oatside Milk"] },
      lunch: lunchPlan[day],
      dinner: { name: "Herbalife Shake + Oatside Milk", ...meals.dinner["Herbalife Shake + Oatside Milk"] },
      snack: snackPlan[day]
    };

    // totals
    planDay.totalCal = planDay.breakfast.cal + planDay.lunch.cal + planDay.dinner.cal + planDay.snack.cal;
    planDay.totalProtein = planDay.breakfast.protein + planDay.lunch.protein + planDay.dinner.protein + planDay.snack.protein;

    currentPlan.push(planDay);

    out += `Day ${planDay.day}\n`;
    out += `  Breakfast: ${planDay.breakfast.name} (${planDay.breakfast.cal} cal, ${planDay.breakfast.protein}g protein)\n`;
    out += `  Lunch: ${planDay.lunch.name} (${planDay.lunch.cal} cal, ${planDay.lunch.protein}g protein)\n`;
    out += `  Dinner: ${planDay.dinner.name} (${planDay.dinner.cal} cal, ${planDay.dinner.protein}g protein)\n`;
    out += `  Snack: ${planDay.snack.name} (${planDay.snack.cal} cal, ${planDay.snack.protein}g protein)\n`;
    out += `  ðŸ‘‰ Total: ${planDay.totalCal} cal, ${planDay.totalProtein}g protein\n\n`;
  }
  document.getElementById("planOutput").innerText = out;
}

function downloadPDF() {
  if (!selectedProfile || currentPlan.length === 0) return alert("Generate plan first!");
  const { jsPDF } = window.jspdf;
  let doc = new jsPDF();
  let calc = calculateBMR(selectedProfile);

  doc.setFontSize(12);
  doc.text(`Meal Plan for ${selectedProfile.name}`, 10, 10);
  doc.text(`BMR: ${calc.bmr.toFixed(0)} kcal/day`, 10, 20);
  doc.text(`Maintenance: ${calc.maintenance.toFixed(0)} kcal/day`, 10, 30);
  doc.text(`Fat Loss: ${calc.fatLoss.toFixed(0)} kcal/day`, 10, 40);
  doc.text(`Muscle Gain: ${calc.muscleGain.toFixed(0)} kcal/day`, 10, 50);

  let rows = currentPlan.map(p => [
    p.day,
    p.breakfast.name,
    p.lunch.name,
    p.dinner.name,
    p.snack.name,
    `${p.totalCal} cal / ${p.totalProtein}g`
  ]);
  doc.autoTable({
    head: [["Day","Breakfast","Lunch","Dinner","Snack","Daily Total"]],
    body: rows,
    startY: 60,
    styles: { fontSize: 8 }
  });
  doc.save("MealPlan.pdf");
}
</script>
</body>
</html>
