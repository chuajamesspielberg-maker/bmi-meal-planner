<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Meal Planner</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h2 { margin-top: 30px; }
    select, input { margin: 5px 0; padding: 5px; }
    .btn { margin-top: 10px; padding: 6px 12px; cursor: pointer; border: 1px solid #444; border-radius: 6px; background: #f2f2f2; }
    .btn:hover { background: #e6e6e6; }
    .delete-btn { background: #ffcccc; border: 1px solid #c00; color: #900; }
    .delete-btn:hover { background: #ff9999; }
    .meal-day { margin-bottom: 20px; padding: 10px; border: 1px solid #ccc; }
  </style>
</head>
<body>
  <h1>Meal Planner</h1>

  <h2>Create Profile</h2>
  <label>Name: <input type="text" id="name"></label><br>
  <label>Age: <input type="number" id="age"></label><br>
  <label>Gender: 
    <select id="gender">
      <option value="male">Male</option>
      <option value="female">Female</option>
    </select>
  </label><br>
  <label>Weight (kg): <input type="number" id="weight"></label><br>
  <label>Height (cm): <input type="number" id="height"></label><br>
  <label>Activity Level:
    <select id="activity">
      <option value="1.2">Sedentary</option>
      <option value="1.375">Lightly active</option>
      <option value="1.55">Moderately active</option>
      <option value="1.725">Very active</option>
      <option value="1.9">Super active</option>
    </select>
  </label><br>

  <h3>Macro Split (%)</h3>
  <label>Protein: <input type="number" id="proteinSplit" value="30"></label><br>
  <label>Carbs: <input type="number" id="carbsSplit" value="40"></label><br>
  <label>Fat: <input type="number" id="fatSplit" value="30"></label><br>

  <h3>Restrictions (optional)</h3>
  <select id="restrictions" multiple>
    <option value="meat">Meat</option>
    <option value="pork">Pork</option>
    <option value="chicken">Chicken</option>
    <option value="fish">Fish</option>
    <option value="veggies">Veggies</option>
    <option value="rice">Rice</option>
    <option value="dairy">Dairy</option>
    <option value="egg">Egg</option>
    <option value="banana">Banana</option>
  </select><br>

  <h3>Plan Goal</h3>
  <select id="goal">
    <option value="maintain">Maintain</option>
    <option value="lose">Lose Weight</option>
    <option value="gain">Gain Weight</option>
  </select><br>

  <button class="btn" onclick="saveProfile()">üíæ Save Profile</button>
  <button class="btn" onclick="resetForm()">üîÑ Reset Form</button>
  <button class="btn delete-btn" onclick="deleteProfile()">üóëÔ∏è Delete Saved Profile</button>

  <h2>Profile</h2>
  <pre id="profileInfo"></pre>

  <h2>Meal Plan</h2>
  <button class="btn" onclick="generateMealPlan()">Generate 14-Day Meal Plan</button>
  <button class="btn" onclick="downloadMealPlan()">Download Meal Plan (PDF)</button>
  <div id="mealPlan"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    let profile = null;

    const foodDB = {
      breakfast: [
        { name: "Herbalife Shake", grams: "2 scoops Formula 1 + 200ml Oatside milk", cal: 220, protein: 17, carbs: 28, fat: 5 },
        { name: "Herbalife Shake + Banana", grams: "2 scoops Formula 1 + 200ml milk + 1 banana", cal: 320, protein: 18, carbs: 55, fat: 6 },
        { name: "Herbalife Shake + Oats", grams: "2 scoops Formula 1 + 200ml milk + 40g oats", cal: 350, protein: 20, carbs: 50, fat: 7 }
      ],
      dinner: [
        { name: "Herbalife Shake", grams: "2 scoops Formula 1 + 200ml Oatside milk", cal: 220, protein: 17, carbs: 28, fat: 5 },
        { name: "Herbalife Shake + Banana", grams: "2 scoops Formula 1 + 200ml milk + 1 banana", cal: 320, protein: 18, carbs: 55, fat: 6 },
        { name: "Herbalife Shake + Oats", grams: "2 scoops Formula 1 + 200ml milk + 40g oats", cal: 350, protein: 20, carbs: 50, fat: 7 }
      ],
      lunch: [
        { name: "Grilled Chicken + Rice", grams: "150g chicken + 100g cooked rice + 50g broccoli", cal: 400, protein: 38, carbs: 30, fat: 8 },
        { name: "Beef Stir Fry", grams: "120g lean beef + 150g veggies", cal: 350, protein: 32, carbs: 15, fat: 14 },
        { name: "Tofu + Rice", grams: "150g tofu + 100g rice + 100g veggies", cal: 380, protein: 25, carbs: 40, fat: 12 }
      ],
      snack: [
        { name: "Banana", grams: "120g", cal: 105, protein: 1, carbs: 27, fat: 0 },
        { name: "Boiled Egg", grams: "1 large (50g)", cal: 70, protein: 6, carbs: 1, fat: 5 },
        { name: "Banana + Egg", grams: "120g banana + 50g egg", cal: 175, protein: 7, carbs: 28, fat: 5 },
        { name: "Salad", grams: "100g mixed greens + 20g vinaigrette", cal: 90, protein: 2, carbs: 8, fat: 5 }
      ]
    };

    function calculateBMR(weight, height, age, gender) {
      return gender === "male"
        ? 10 * weight + 6.25 * height - 5 * age + 5
        : 10 * weight + 6.25 * height - 5 * age - 161;
    }

    function saveProfile() {
      const name = document.getElementById("name").value.trim();
      const age = parseInt(document.getElementById("age").value);
      const gender = document.getElementById("gender").value;
      const weight = parseFloat(document.getElementById("weight").value);
      const height = parseFloat(document.getElementById("height").value);
      const activity = parseFloat(document.getElementById("activity").value);
      const goal = document.getElementById("goal").value;

      if (!name || !age || !weight || !height) {
        alert("Please fill in all required fields.");
        return;
      }

      const bmr = calculateBMR(weight, height, age, gender);
      const maintain = Math.round(bmr * activity);
      const lose = maintain - 500;
      const gain = maintain + 500;

      let targetCalories = maintain;
      if (goal === "lose") targetCalories = lose;
      if (goal === "gain") targetCalories = gain;

      const proteinPct = parseInt(document.getElementById("proteinSplit").value);
      const carbsPct = parseInt(document.getElementById("carbsSplit").value);
      const fatPct = parseInt(document.getElementById("fatSplit").value);

      const proteinTarget = Math.round((targetCalories * (proteinPct / 100)) / 4);
      const carbsTarget = Math.round((targetCalories * (carbsPct / 100)) / 4);
      const fatTarget = Math.round((targetCalories * (fatPct / 100)) / 9);

      profile = {
        name, age, gender, weight, height, activity, goal,
        macroSplit: { protein: proteinPct, carbs: carbsPct, fat: fatPct },
        restrictions: Array.from(document.getElementById("restrictions").selectedOptions).map(opt => opt.value),
        bmr, maintain, lose, gain, targetCalories, proteinTarget, carbsTarget, fatTarget
      };

      localStorage.setItem("mealPlannerProfile", JSON.stringify(profile));
      showProfile();
      alert("‚úÖ Profile saved successfully!");
    }

    function showProfile() {
      if (!profile) return;
      document.getElementById("profileInfo").innerText = `
Name: ${profile.name}
Age: ${profile.age}
Gender: ${profile.gender}
Weight: ${profile.weight} kg
Height: ${profile.height} cm
Activity Factor: ${profile.activity}
Goal: ${profile.goal.toUpperCase()}
BMR: ${profile.bmr} kcal/day
Calories: Maintain ${profile.maintain}, Weight Loss ${profile.lose}, Weight Gain ${profile.gain}
Target Calories (for goal): ${profile.targetCalories}
Target Macros: Protein ${profile.proteinTarget}g | Carbs ${profile.carbsTarget}g | Fat ${profile.fatTarget}g
Macro Split: Protein ${profile.macroSplit.protein}%, Carbs ${profile.macroSplit.carbs}%, Fat ${profile.macroSplit.fat}%
Restrictions: ${profile.restrictions.length ? profile.restrictions.join(", ") : "None"}
      `;
    }

    window.onload = function() {
      const savedProfile = localStorage.getItem("mealPlannerProfile");
      if (savedProfile) {
        profile = JSON.parse(savedProfile);
        showProfile();
        alert(`üëã Welcome back, ${profile.name}! Your profile has been loaded.`);
      }
    };

    function resetForm() {
      document.querySelectorAll("input, select").forEach(el => {
        if (el.type === "select-multiple" || el.multiple) {
          for (let option of el.options) option.selected = false;
        } else if (el.tagName === "SELECT") {
          el.selectedIndex = 0;
        } else {
          el.value = "";
        }
      });
      document.getElementById("profileInfo").innerText = "";
      profile = null;
      alert("Form has been cleared!");
    }

    function deleteProfile() {
      const confirmDelete = confirm("‚ö†Ô∏è Are you sure you want to delete your saved profile? This cannot be undone.");
      if (!confirmDelete) return;

      localStorage.removeItem("mealPlannerProfile");
      document.getElementById("profileInfo").innerText = "";
      profile = null;
      alert("üóëÔ∏è Your saved profile has been permanently deleted.");
    }

    function pickMeal(type) {
      let options = foodDB[type].filter(m => {
        if (!profile.restrictions.length) return true;
        return !profile.restrictions.some(r => m.name.toLowerCase().includes(r));
      });
      return options[Math.floor(Math.random() * options.length)];
    }

    function generateMealPlan() {
      if (!profile) {
        alert("Save profile first!");
        return;
      }
      const planDiv = document.getElementById("mealPlan");
      planDiv.innerHTML = "";

      for (let day = 1; day <= 14; day++) {
        let meals = {
          breakfast: pickMeal("breakfast"),
          lunch: pickMeal("lunch"),
          dinner: pickMeal("dinner"),
          snack: pickMeal("snack")
        };

        let totals = { cal: 0, protein: 0, carbs: 0, fat: 0 };
        Object.values(meals).forEach(m => {
          totals.cal += m.cal;
          totals.protein += m.protein;
          totals.carbs += m.carbs;
          totals.fat += m.fat;
        });

        const div = document.createElement("div");
        div.className = "meal-day";
        div.innerHTML = `
          <h3>Day ${day}</h3>
          Breakfast: ${meals.breakfast.name} (${meals.breakfast.grams})<br>
          Lunch: ${meals.lunch.name} (${meals.lunch.grams})<br>
          Dinner: ${meals.dinner.name} (${meals.dinner.grams})<br>
          Snack: ${meals.snack.name} (${meals.snack.grams})<br><br>
          <b>Daily Totals:</b> ${totals.cal} kcal | Protein: ${totals.protein}g | Carbs: ${totals.carbs}g | Fat: ${totals.fat}g<br>
          <b>Targets:</b> ${profile.targetCalories} kcal | Protein: ${profile.proteinTarget}g | Carbs: ${profile.carbsTarget}g | Fat: ${profile.fatTarget}g
        `;
        planDiv.appendChild(div);
      }
    }

    function downloadMealPlan() {
      if (!profile) {
        alert("Save profile and generate plan first!");
        return;
      }
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      doc.setFontSize(12);
      doc.text("Meal Plan", 10, 10);
      doc.text(`Name: ${profile.name}`, 10, 20);
      doc.text(`Goal: ${profile.goal}`, 10, 30);
      doc.text(`BMR: ${profile.bmr} kcal`, 10, 40);
      doc.text(`Target Calories: ${profile.targetCalories}`, 10, 50);
      doc.text(`Macros: Protein ${profile.proteinTarget}g, Carbs ${profile.carbsTarget}g, Fat ${profile.fatTarget}g`, 10, 60);

      let y = 70;
      const days = document.querySelectorAll(".meal-day");
      days.forEach((day, i) => {
        if (y > 270) { doc.addPage(); y = 20; }
        doc.text(day.innerText, 10, y);
        y += 60;
      });

      doc.save("mealplan.pdf");
    }
  </script>
</body>
</html>
