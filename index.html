<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Pinoy Meal Planner</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background-color: #0d0d0d;
    color: #d4ffd4;
    margin: 0;
    display: flex;
    height: 100vh;
    overflow: hidden;
  }
  /* Sidebar with profiles */
  #sidebar {
    background-color: #1a1a1a;
    width: 260px;
    padding: 20px;
    box-sizing: border-box;
    overflow-y: auto;
  }
  #sidebar h2 {
    color: #39ff14;
    text-align: center;
    margin-top: 0;
  }
  #profileList {
    list-style: none;
    padding-left: 0;
    margin: 0;
  }
  #profileList li {
    padding: 10px;
    margin-bottom: 8px;
    background-color: #262626;
    border-radius: 6px;
    cursor: pointer;
    box-shadow: 0px 0px 5px rgba(57, 255, 20, 0.3);
    display: flex;
    justify-content: space-between;
    align-items: center;
    color: #a8ffb0;
  }
  #profileList li.active {
    background-color: #39ff14;
    color: black;
  }
  #profileList li:hover:not(.active) {
    background-color: #2ecc71;
    color: black;
  }
  #profileList button.delete-btn {
    background: transparent;
    border: none;
    color: #ff4c4c;
    font-weight: bold;
    cursor: pointer;
    font-size: 14px;
    margin-left: 10px;
  }
  
  /* Main container */
  .container {
    flex: 1;
    max-width: 600px;
    margin: auto;
    padding: 20px;
    overflow-y: auto;
    box-sizing: border-box;
  }
  h1, h2 {
    color: #39ff14;
    text-align: center;
    margin-bottom: 10px;
  }
  p {
    margin: 10px 0 5px;
  }
  select, input[type=number], input[type=text] {
    width: 100%;
    padding: 8px 10px;
    border-radius: 5px;
    border: none;
    margin-bottom: 12px;
    font-size: 1em;
  }
  button {
    background-color: #39ff14;
    color: black;
    border: none;
    padding: 14px;
    margin-top: 10px;
    border-radius: 5px;
    font-weight: bold;
    cursor: pointer;
    width: 100%;
  }
  button:hover {
    background-color: #2ecc71;
  }
  .step {
    display: none;
    padding: 15px;
    background-color: #1a1a1a;
    border-radius: 10px;
    box-shadow: 0px 0px 15px rgba(57, 255, 20, 0.5);
  }
  .step.active {
    display: block;
  }
  .meal-card {
    background-color: #262626;
    border-radius: 8px;
    padding: 10px;
    margin-bottom: 15px;
    box-shadow: 0px 0px 10px rgba(57, 255, 20, 0.2);
  }
  .meal-card h3 {
    color: #39ff14;
    margin: 6px 0;
  }
  .meal-card img {
    max-width: 100%;
    border-radius: 10px;
    margin-top: 6px;
  }
  .macro {
    font-size: 0.9em;
    color: #a8ffb0;
    margin-top: 4px;
  }
  #profileNameInput {
    margin-bottom: 15px;
  }
  #regenerateBtn {
    background-color: #ffbf00;
    color: black;
    margin-top: 0;
  }
  #regenerateBtn:hover {
    background-color: #e6ac00;
  }
  /* Scrollbar for sidebar */
  #sidebar::-webkit-scrollbar {
    width: 6px;
  }
  #sidebar::-webkit-scrollbar-thumb {
    background-color: rgba(57,255,20,0.5);
    border-radius: 3px;
  }
</style>
</head>
<body>

<!-- Sidebar -->
<div id="sidebar">
  <h2>Profiles</h2>
  <ul id="profileList"></ul>
  <button id="newProfileBtn">+ New Profile</button>
</div>

<!-- Main container -->
<div class="container">
  <h1>Pinoy Meal Planner</h1>

  <div id="stepContainer">
    <!-- Step 0: Profile Name -->
    <div id="step0" class="step">
      <h2>Create Profile</h2>
      <p>Enter client name:</p>
      <input type="text" id="profileNameInput" placeholder="e.g. Juan Dela Cruz" />
      <button onclick="saveNewProfile()">Save Profile</button>
    </div>

    <!-- Step 1: Goal -->
    <div id="step1" class="step">
      <h2>Step 1: Goal</h2>
      <p>Select your goal:</p>
      <select id="goal">
        <option value="lose">Lose Weight</option>
        <option value="gain">Gain Muscle</option>
        <option value="maintain">Maintain Weight</option>
      </select>
      <button onclick="nextStep(2)">Next</button>
    </div>

    <!-- Step 2: Weight & Age -->
    <div id="step2" class="step">
      <h2>Step 2: Information</h2>
      <p>Enter your weight (kg):</p>
      <input type="number" id="weight" placeholder="e.g. 70" min="1" />
      <p>Enter your age:</p>
      <input type="number" id="age" placeholder="e.g. 30" min="1" />
      <button onclick="nextStep(3)">Next</button>
    </div>

    <!-- Step 3: Meal Plan -->
    <div id="step3" class="step">
      <h2>Step 3: Meal Plan</h2>
      <div id="mealPlan"></div>
      <button id="generateBtn" onclick="generateMealPlan()">Generate Meal Plan</button>
      <button id="regenerateBtn" style="display:none;" onclick="regenerateMealPlan()">Regenerate Meal Plan</button>
    </div>
  </div>
</div>

<script>
  // Filipino-friendly meal set with sample base64 placeholders
  const mealImages = {
    "Adobo Chicken": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAIAAAD2Ht6kAAAABnRSTlMAAAAAAABupgeRAAAANUlEQVR4nO3BMQEAAAgDoJvcva+GET3BkDOmTNnTq1ChQoUKFChQoUKFChQoUKFChQoUKFCk6hPmighOTMAAAAASUVORK5CYII=",
    "Sinigang na Baboy": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAIAAAD2Ht6kAAAABnRSTlMAAAAAAABupgeRAAAAJklEQVR4nO3BMQEAAAwCoNm/9EngAAAAAAAAAAAAAAAAAAAAAAAAAAAALgBg+QAAeeMiH7AAAAAASUVORK5CYII=",
    "Pancit Canton": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAIAAAD2Ht6kAAAABnRSTlMAAAAAAABupgeRAAAAIklEQVR4nO3BMQEAAAgCoNm/qVESAAAAAAAAAAAAAAAAAAAAAAAAAAA8BjB8u4AAu28wswAAAABJRU5ErkJggg==",
    "Laing": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAIAAAD2Ht6kAAAABnRSTlMAAAAAAABupgeRAAAAJElEQVR4nO3BMQEAAAgDoJvcva+GET3BkDOmTNnTq1ChQoUKFChQoUKFChQoUKFChQoUKFCk6hM+qhxGTMAAAAASUVORK5CYII=",
    "Lechon Kawali": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAIAAAD2Ht6kAAAABnRSTlMAAAAAAABupgeRAAAALUlEQVR4nO3BMQEAAAgCoNm/9EntnIy2nTq1ChQoUKFChQoUKFChQoUKFChQoUKFCkKhn6UGiIAAAAASUVORK5CYII=",
    "Herbalife Formula 1 Shake": "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEASABIAAD",
    "Grilled Chicken Breast": "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEASABIAAD",
    "Oatmeal with Banana": "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEASABIAAD",
    "Tuna Salad": "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEASABIAAD",
    "Beef Stir Fry": "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEASABIAAD"
  };

  const meals = [
    { name: "Adobo Chicken", calories: 320, protein: 30, carbs: 10, fat: 18 },
    { name: "Sinigang na Baboy", calories: 280, protein: 28, carbs: 15, fat: 12 },
    { name: "Pancit Canton", calories: 350, protein: 22, carbs: 45, fat: 14 },
    { name: "Laing", calories: 300, protein: 12, carbs: 20, fat: 22 },
    { name: "Lechon Kawali", calories: 400, protein: 35, carbs: 0, fat: 30 }
  ];

  const extraMeal = { name: "Herbalife Formula 1 Shake", calories: 200, protein: 9, carbs: 25, fat: 3 };

  let profiles = {};
  let currentProfile = null;
  let currentStep = 0;

  const profileListEl = document.getElementById("profileList");
  const containerSteps = document.querySelectorAll(".step");

  const profileNameInput = document.getElementById("profileNameInput");
  const goalSelect = document.getElementById("goal");
  const weightInput = document.getElementById("weight");
  const ageInput = document.getElementById("age");
  const mealPlanDiv = document.getElementById("mealPlan");
  const regenerateBtn = document.getElementById("regenerateBtn");
  const newProfileBtn = document.getElementById("newProfileBtn");

  newProfileBtn.addEventListener("click", () => {
    currentProfile = null;
    clearInputs();
    showStep(0);
    setActiveProfile(null);
  });

  function clearInputs() {
    profileNameInput.value = "";
    goalSelect.value = "lose";
    weightInput.value = "";
    ageInput.value = "";
    mealPlanDiv.innerHTML = "";
    regenerateBtn.style.display = "none";
  }

  function loadProfiles() {
    const saved = localStorage.getItem("pinoyMealProfiles");
    profiles = saved ? JSON.parse(saved) : {};
    renderProfileList();
  }

  function saveProfiles() {
    localStorage.setItem("pinoyMealProfiles", JSON.stringify(profiles));
  }

  function renderProfileList() {
    profileListEl.innerHTML = "";
    for (const name in profiles) {
      const li = document.createElement("li");
      li.textContent = name;
      li.title = `Client: ${name}`;
      li.onclick = () => loadProfile(name);
      if (currentProfile === name) {
        li.classList.add("active");
      }
      const delBtn = document.createElement("button");
      delBtn.textContent = "X";
      delBtn.className = "delete-btn";
      delBtn.onclick = (e) => {
        e.stopPropagation();
        if (confirm(`Delete profile "${name}"? This cannot be undone.`)) {
          delete profiles[name];
          if (currentProfile === name) {
            currentProfile = null;
            clearInputs();
            showStep(0);
          }
          saveProfiles();
          renderProfileList();
        }
      };
      li.appendChild(delBtn);
      profileListEl.appendChild(li);
    }
  }

  function showStep(step) {
    containerSteps.forEach(s => s.classList.remove("active"));
    document.getElementById(`step${step}`).classList.add("active");
    currentStep = step;
  }

  // Fixed nextStep function with correct validation checks
  function nextStep(step) {
    if (step === 1) {
      // Step 0 -> Step 1: Validate profile name
      if (!profileNameInput.value.trim()) {
        alert("Please enter a valid client name.");
        return;
      }
    }
    if (step === 2) {
      // Step 1 -> Step 2: No validation needed here
      // Just move on
    }
    if (step === 3) {
      // Step 2 -> Step 3: Validate weight and age
      const weight = parseFloat(weightInput.value);
      const age = parseInt(ageInput.value);
      if (!weight || weight <= 0 || !age || age <= 0) {
        alert("Please enter valid weight and age.");
        return;
      }
    }
    showStep(step);
  }

  function saveNewProfile() {
    const name = profileNameInput.value.trim();
    if (!name) {
      alert("Please enter a valid client name.");
      return;
    }
    if (profiles[name]) {
      if (!confirm(`Profile "${name}" already exists. Overwrite?`)) return;
    }
    profiles[name] = {
      goal: "lose",
      weight: null,
      age: null,
      mealPlans: []
    };
    currentProfile = name;
    saveProfiles();
    renderProfileList();
    goalSelect.value = "lose";
    weightInput.value = "";
    ageInput.value = "";
    showStep(1);
    setActiveProfile(name);
  }

  function loadProfile(name) {
    const p = profiles[name];
    if (!p) return;
    currentProfile = name;
    setActiveProfile(name);
    profileNameInput.value = name;
    goalSelect.value = p.goal || "lose";
    weightInput.value = p.weight || "";
    ageInput.value = p.age || "";
    showStep(1);
    if (p.mealPlans && p.mealPlans.length > 0) {
      displayMealPlan(p.mealPlans[p.mealPlans.length - 1]);
      regenerateBtn.style.display = "inline-block";
    } else {
      mealPlanDiv.innerHTML = "";
      regenerateBtn.style.display = "none";
    }
  }

  function setActiveProfile(name) {
    currentProfile = name;
    renderProfileList();
  }

  function generateMealPlan() {
    if (!currentProfile) {
      alert("Please create or select a profile first.");
      return;
    }
    const goal = goalSelect.value;
    const weight = parseFloat(weightInput.value);
    const age = parseInt(ageInput.value);
    if (!weight || weight <= 0 || !age || age <= 0) {
      alert("Please enter valid weight and age.");
      return;
    }

    let caloriesNeeded = weight * (goal === "lose" ? 25 : goal === "gain" ? 35 : 30);

    let mealPlan = [];

    if (goal === "lose") {
      mealPlan.push(extraMeal);
    }

    let shuffled = [...meals].sort(() => 0.5 - Math.random());
    mealPlan = mealPlan.concat(shuffled.slice(0, 3));

    if (goal === "lose") {
      mealPlan.push(extraMeal);
    }

    let totalCalories = mealPlan.reduce((sum, m) => sum + m.calories, 0);
    let totalProtein = mealPlan.reduce((sum, m) => sum + m.protein, 0);
    let totalCarbs = mealPlan.reduce((sum, m) => sum + m.carbs, 0);
    let totalFat = mealPlan.reduce((sum, m) => sum + m.fat, 0);

    const plan = {
      date: new Date().toISOString(),
      goal,
      weight,
      age,
      caloriesNeeded,
      meals: mealPlan,
      totals: {
        calories: totalCalories,
        protein: totalProtein,
        carbs: totalCarbs,
        fat: totalFat
      }
    };

    profiles[currentProfile].goal = goal;
    profiles[currentProfile].weight = weight;
    profiles[currentProfile].age = age;
    profiles[currentProfile].mealPlans.push(plan);
    saveProfiles();

    displayMealPlan(plan);
    regenerateBtn.style.display = "inline-block";
    showStep(3);
  }

  function regenerateMealPlan() {
    generateMealPlan();
  }

  function displayMealPlan(plan) {
    let output = `<h3>Target Calories: ${plan.caloriesNeeded.toFixed(0)} kcal</h3>`;
    plan.meals.forEach(m => {
      output += `
        <div class="meal-card">
          <h3>${m.name}</h3>
          <img src="${mealImages[m.name] || 'https://via.placeholder.com/300'}" alt="${m.name}">
          <p class="macro">Calories: ${m.calories} | Protein: ${m.protein}g | Carbs: ${m.carbs}g | Fat: ${m.fat}g</p>
        </div>
      `;
    });
    output += `<h3>Daily Total: ${plan.totals.calories} kcal | Protein: ${plan.totals.protein}g | Carbs: ${plan.totals.carbs}g | Fat: ${plan.totals.fat}g</h3>`;
    mealPlanDiv.innerHTML = output;
  }

  function init() {
    loadProfiles();
    if (!currentProfile) {
      showStep(0);
    }
  }

  init();
</script>
</body>
</html>
